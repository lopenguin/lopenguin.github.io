---
description: Radio Controlled Car
layout: post
---
<body>
<h3>Quick Links</h3>
<ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#circuit">Electronics</a></li>
    <li><a href="#video">Video</a></li>
    <li><a href="https://github.com/lopenguin/radio-car-demo">Code (github)</a></li>
</ul>

<h3 id="overview">Overview</h3>
<p>
    The goal of this project was to demonstrate a protocol for wirelessly communicating with a robot in real time. The eventual goal is to effortlessly send motor commands and receive sensor data from a nearby robot. I chose to use 900 MHz radio for its high range and decent speed. I also have an amateur radio license (technician class), which allows me to transmit on lesser used (and therefore less noisy) parts of the 900 MHz band such as the 906 MHz I used for this project.
</p>
<p>
    I created a system that uses two-way radio communication between a small two-wheeled car (provided for us earlier in ME 14) and a controller module. The car has a laser-cut wooden chasis that holds three wheels in a typical tricylce formation. The two back wheels are powered by the motor, while a front roller provides stability and allows turning. The car uses a Teensy 4.0 and external radio breakout board (<a href="https://www.adafruit.com/product/3070">link</a>) to maintain communication. The main electronics, which include a forward-facing distance sensor, are powered by a small 1S lithium polymer battery. The Teensy is also connected to two motors that drive the wheels of the robot using a 12 V lithium-ion power supply. The controller, based on an Adafruit Feather 32u4 with 900 MHz radio (<a href="https://www.adafruit.com/product/3076">link</a>), has a joystick that wirelessly controls the motion of the car, a 7-segment display that shows the car's distance sensor readout, and an RGB LED that shows the signal strength (RSSI).
</p>
<div class="row">
    <div class="col-l50">
        <img src="/assets/projects/rc-car/desktop_station.jpg" title="Please ignore the uh hammer and sickle in the background... it's just a Discord server!">
        <div class="caption">
            The car's remote controller
        </div>
    </div>
    <div class="col-r50">
        <img src="/assets/projects/rc-car/car_front.jpg" title="Little bit of packing going on back there eh?">
        <div class="caption">
            The remote controlled car
        </div>
    </div>
</div>
<p>
    After a fair bit of debugging, things actually worked out pretty well. Here's a short list of problems I encountered, and how I tried to address them:
    <ul>
        <li>
            <b>Acknowledged packet bugs.</b> Acknowledged packets are an important part of reliable radio communication. Without acknowledgement, there is no way of knowing if the tranmitted message was received without directly observed the receiver. The library I'm using (Radiohead) had a nice automatic packet acknowledgement handler that would even resend messages if they were not received. It worked quite well in one driection, but didn't work at all for two-way communication (for reasons I do not understand). Instead, I switched to a manual acknowledgement system.
        </li>
        <li>
            <b>Poor motor performance.</b> This was probably the most major of the problems I faced on this project. I relied on a previously purchased motor system that already struggled under the weight of the wooden chasis and breadboard. Adding a radio antenna, two battery packets, and a second breadboard for motor control proved to be near the limit of the motor's torque outputs. They could barely move the car on flat ground and turning was almost impossible. I tried putting some of the components on an externally wheeled system to reduce the load on the front roller, but that did not significantly improve performance. I ended up only running the car on favorably inclined ground and shifting all components towards the back in order to get some good performance out of it. Major limitation here was the motors.
        </li>
        <li>
            <b>Spotty radio communication.</b> The code I wrote is designed to transmit a new command to the car every 25 milliseconds. The microprocessor can process transmission and receipt in less than 1 millisecond, but without robust error checking and resending many of these packets failed. This means the radio, when in direct communication, was often recieving new drive commands far less often than every 25 milliseconds. As communication became more spotty, the lag time increased as well. In the future I may try to add robust error checking and resending, but until then I mostly solved this problem by creating an automatic timeout that stops the car if not packets are received for more than 250 ms.
        </li>
    </ul>
</p>
<p>
    In summary, I built 900 MHz radio remote controlled car. As a demonstration of using radio to control a small robot, the system worked quite well. Reliable commumication allowed real time control of the vehicle and obtaining of feedback. However, this demonstration was limited by weak motors and poor radio reliability control.
</p>

<h3 id="circuit">Electronics</h3>
<p>
    <div class="row">
        <div class="col-l50">
            Car:
            <img src="/assets/projects/rc-car/car_circuit.jpg" title="A bit disconnected, but I think you get the idea.">
            <ul>
                <li>Car motion: two Pololu 15:1 micro gearmotors (<a href="https://www.pololu.com/product/4788">link</a>)</li>
                <li>Motor control: L293d h-bridge chip (<a href="https://www.ti.com/lit/ds/symlink/l293.pdf">datasheet</a>)</li>
                <li>Microprocessor: Teensy 4.0 (<a href="https://www.pjrc.com/store/teensy40.html">link</a>)</li>
                <li>Distance sensor: VL53L1X breakout board (<a href="https://www.sparkfun.com/products/14722">link</a>)</li>
                <li>Battery: 1S LiPo, 2.5 Ah</li>
                <li>Motor battery: three Li-ion batteries (12 V)</li>
                <li>Radio module: Adafruit RF69 breakout board (<a href="https://www.adafruit.com/product/3070">link</a>)</li>
                <li>Antenna: 900 MHz rubber duck antenna</li>
            </ul>
        </div>
        <div class="col-r50">
            Controller:
            <img src="/assets/projects/rc-car/controller_circuit.jpg" title="That 7-segment display was awesome.">
            <ul>
                <li>Microprocessor: Adafruit Feather 32u4 with radio (<a href="https://www.adafruit.com/product/3076">link</a>)</li>
                <li>Joystick: simple 2-axis potentiometer joystick</li>
                <li>7-segment display: Adafruit I2C breakout (<a href="https://www.adafruit.com/product/878">link</a>)</li>
                <li>Connection indicator LED: RGB LED</li>
                <li>Antenna: 900 MHz rubber duck antenna</li>
            </ul>
        </div>
    </div>
    I'm not going to include a circuit diagram here because the components can only really fit together in one way. The display and distance sensor are I2C, the radio modules operate over SPI, and the other components just need to be connected to digital or analog pins.
</p>


<h3 id="video">Video</h3>
<p>
    Here's a video of a small test of the car's radio tranmission capabilities. I positioned the car in another room (so I could not see it) and controlled it exclusively via telemetry from the front distance sensor. For this simple test, I tried to drive the bot close to the wall without actually touching it. Note that the red light indicates tranmission stability, not whether the car is touching the wall.
</p>
<center>
    <div class="iframe-container">
        <iframe width="100%" src="https://www.youtube.com/embed/RTLGLjcnIFs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
</center>
</body>
